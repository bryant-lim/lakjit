<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lakjit | Modern Traditional Chinese Calendar | ÊõÜÊó•</title>
    <meta name="description"
        content="Discover Lakjit (ÊõÜÊó•), the modern vintage Chinese calendar. Get daily auspicious (Yi/Ji) updates, lunar dates, and traditional quotes in a beautiful, no-scroll layout.">
    <meta name="keywords"
        content="Lakjit, ÊõÜÊó•, Chinese Calendar, Lunar Calendar, Hokkien, Auspicious Dates, ÂÆúÂøå, Modern Calendar">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Lakjit | Modern Traditional Chinese Calendar">
    <meta property="og:description"
        content="Your daily digital companion for traditional lunar dates and auspicious activities.">
    <meta property="og:url" content="https://lakjit.my/">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='lak-jit.jpg') }}">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#F5F5DC">
    <meta name="theme-color" content="#2C2C2C" media="(prefers-color-scheme: dark)">

    <!-- Apple iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lakjit">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-192.jpg') }}">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- html2canvas for Share as Image -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body{% if is_night_mode %} class="night-mode" {% endif %}>
    <!-- Cherry Blossom Petals Animation -->
    <div class="sakura-container">
        <div class="petal petal-1"></div>
        <div class="petal petal-2"></div>
        <div class="petal petal-3"></div>
        <div class="petal petal-4"></div>
        <div class="petal petal-5"></div>
        <div class="petal petal-6"></div>
        <div class="petal petal-7"></div>
        <div class="petal petal-8"></div>
        <div class="petal petal-9"></div>
        <div class="petal petal-10"></div>
        <div class="petal petal-11"></div>
        <div class="petal petal-12"></div>
        <div class="petal petal-13"></div>
        <div class="petal petal-14"></div>
        <div class="petal petal-15"></div>
        <div class="petal petal-16"></div>
        <div class="petal petal-17"></div>
        <div class="petal petal-18"></div>
    </div>

    <div class="container">


        <!-- Content Wrapper for vertical centering -->
        <div class="content-wrapper">
            <!-- Countdown Timer -->
            <div class="countdown-timer">
                <span id="countdown-text">Ë∑ùÈõ¢Ëæ≤ÊõÜÊñ∞Âπ¥ÈÇÑÊúâ
                    <span class="countdown-numbers" id="countdown-days">{{ countdown_days }}</span> Â§©
                    <span class="countdown-numbers" id="countdown-hours">{{ countdown_hours }}</span> Â∞èÊôÇ
                    <span class="countdown-numbers" id="countdown-minutes">{{ countdown_minutes }}</span> ÂàÜ
                    <span class="countdown-numbers" id="countdown-seconds">{{ countdown_seconds }}</span> Áßí
                </span>
            </div>

            <!-- Date Header -->
            <div class="date-header">{{ year }} Âπ¥ {{ month }} Êúà</div>

            <!-- Big Date -->
            <div class="big-date">{{ day }}</div>

            <!-- Weekday with Lunar Date -->
            <div class="weekday">{{ weekday_zh }} | {{ lunar_date_short }}</div>



            <!-- Divider -->
            <div class="divider"></div>

            <!-- Activities Section (Yi & Ji inline) -->
            <div class="activities">
                <img src="{{ url_for('static', filename='ji-icon.png') }}" alt="ÂÆú" class="yi-ji-icon"> {% for item in
                good_for %}{{ item }}{% if not loop.last %}Ôºå{% endif %}{% endfor %} | <img
                    src="{{ url_for('static', filename='yi-icon.png') }}" alt="Âøå" class="yi-ji-icon"> {% for item in
                bad_for %}{{ item }}{% if not loop.last %}Ôºå{% endif %}{% endfor %}
            </div>

            <!-- Daily Quote -->
            <div class="daily-quote">{{ daily_quote }}</div>
        </div>

        <!-- Footer -->
        <div class="footer">È¶¨Âπ¥üê¥ 2026</div>

        <!-- Day Progress Bar -->
        <div class="progress-bar-container">
            <div class="progress-bar-fill" style="width: {{ day_progress }}%"></div>
        </div>
    </div>

    <!-- Share as Image Button -->
    <button class="share-button" id="share-button" aria-label="Share as image" title="Share as image">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
            <polyline points="16 6 12 2 8 6"></polyline>
            <line x1="12" y1="2" x2="12" y2="15"></line>
        </svg>
    </button>

    <script>
        // Real-time countdown update
        const cnyTimestamp = {{ cny_timestamp }};

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = cnyTimestamp - now;

            if (distance < 0) {
                // After CNY: Show greeting message
                document.getElementById('countdown-text').textContent = 'Lak-JitÊÅ≠Á•ùÂ§ßÂÆ∂ ÊÅ≠ÂñúÁôºË≤°ÔºÅËê¨‰∫ãÂ¶ÇÊÑèÔºÅÈ¶¨Âπ¥Ë°åÂ§ßÈÅã';
                document.getElementById('countdown-days').textContent = '';
                document.getElementById('countdown-hours').textContent = '';
                document.getElementById('countdown-minutes').textContent = '';
                document.getElementById('countdown-seconds').textContent = '';
                clearInterval(countdownInterval);
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('countdown-days').textContent = days;
            document.getElementById('countdown-hours').textContent = hours;
            document.getElementById('countdown-minutes').textContent = minutes;
            document.getElementById('countdown-seconds').textContent = seconds;
        }

        // Update every second
        const countdownInterval = setInterval(updateCountdown, 1000);

        // Client-side night mode detection
        function checkNightMode() {
            const now = new Date();
            const hour = now.getHours();
            const isNight = hour >= 20 || hour < 7;

            if (isNight) {
                document.body.classList.add('night-mode');
            } else {
                document.body.classList.remove('night-mode');
            }
        }

        // Check night mode on load and every minute
        checkNightMode();
        setInterval(checkNightMode, 60000); // Check every minute

        // Share as Image Functionality
        document.getElementById('share-button').addEventListener('click', async function () {
            const shareContainer = document.createElement('div');
            shareContainer.className = 'share-container';

            const isNightMode = document.body.classList.contains('night-mode');

            if (isNightMode) {
                shareContainer.style.backgroundImage = "url('{{ url_for('static', filename='background-night.jpg') }}')";
                shareContainer.style.color = '#E0E0E0';
                shareContainer.style.filter = 'brightness(0.6)';
            } else {
                shareContainer.style.backgroundImage = "url('{{ url_for('static', filename='background.jpg') }}')";
                shareContainer.style.color = '#000000';
            }

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'share-content';

            const dateHeader = document.querySelector('.date-header');
            if (dateHeader) contentWrapper.appendChild(dateHeader.cloneNode(true));

            const bigDate = document.querySelector('.big-date');
            if (bigDate) contentWrapper.appendChild(bigDate.cloneNode(true));

            const weekday = document.querySelector('.weekday');
            if (weekday) contentWrapper.appendChild(weekday.cloneNode(true));

            const divider = document.createElement('div');
            divider.className = 'divider';
            contentWrapper.appendChild(divider);

            const activities = document.querySelector('.activities');
            if (activities) contentWrapper.appendChild(activities.cloneNode(true));

            const dailyQuote = document.querySelector('.daily-quote');
            if (dailyQuote) contentWrapper.appendChild(dailyQuote.cloneNode(true));

            shareContainer.appendChild(contentWrapper);
            document.body.appendChild(shareContainer);

            try {
                const canvas = await html2canvas(shareContainer, {
                    width: 1080,
                    height: 1350,
                    scale: 2,
                    backgroundColor: null,
                    logging: false,
                    useCORS: true
                });

                canvas.toBlob(function (blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const today = new Date();
                    const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                    link.download = `Lakjit-Calendar-${dateStr}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                }, 'image/png');

            } catch (error) {
                console.error('Error generating image:', error);
                alert('Failed to generate image. Please try again.');
            } finally {
                document.body.removeChild(shareContainer);
            }
        });
    </script>
    </body>

</html>