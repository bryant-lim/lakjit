<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Chinese Calendar</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+TC:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="static/style.css">

    <!-- Lunar JS -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.7.7/lunar.min.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <div class="calendar-paper">
        <!-- Header Section -->
        <header class="v-header">
            <!-- Left: Month English -->
            <div class="header-side left">
                <div class="en-month" id="en-month">JANUARY</div>
                <div class="side-couplet">ÂúãÈÅãÂÆâÂÆöÁôæ‰∫ãÂ•Ω</div>
            </div>

            <!-- Center: Year Box -->
            <div class="header-center">
                <div class="year-box" id="year-box">2026</div>
            </div>

            <!-- Right: Month Chinese -->
            <div class="header-side right">
                <div class="zh-month" id="zh-month">1ÊúàÂ§ß</div>
                <div class="side-couplet">ÊôÇÈöõËä≥Êò•Ëê¨Ë±°Êñ∞</div>
            </div>
        </header>

        <!-- Main Date Section -->
        <main class="v-main-date">
            <div class="giant-red-num" id="day-num">
                2
                <div class="zodiac-overlay" id="zodiac-overlay">
                    <!-- Icons injected by JS -->
                </div>
            </div>
        </main>

        <!-- Middle Banners -->
        <div class="v-middle-banners">
            <!-- Lunar Date -->
            <div class="banner-box left">
                <div class="banner-content">
                    <span class="banner-label">Ëæ≤ÊõÜ</span>
                    <span id="lunar-date-text">--</span>
                </div>
            </div>

            <!-- Solar Term / Festival -->
            <div class="banner-box center">
                <div class="banner-content">
                    <span id="solar-term-text">--</span>
                </div>
            </div>

            <!-- Weekday -->
            <div class="banner-box right">
                <div class="banner-content">
                    <span class="zh-weekday" id="zh-weekday">--</span>
                    <span class="en-weekday" id="en-weekday">--</span>
                </div>
            </div>
        </div>

        <!-- Bottom Grid Section -->
        <footer class="v-bottom-section">
            <div class="bottom-container">
                <!-- Left: Yi (Good) -->
                <div class="col-yi">
                    <div class="yi-ji-circle">ÂÆú</div>
                    <ul id="yi-list" class="luck-list"></ul>
                </div>

                <!-- Center: BaZi and Grid -->
                <div class="col-center-grid">
                    <!-- Populated by JS -->
                </div>

                <!-- Right: Ji (Bad) -->
                <div class="col-ji">
                    <div class="yi-ji-circle red">Âøå</div>
                    <ul id="ji-list" class="luck-list"></ul>
                </div>
            </div>
        </footer>
    </div>

    <!-- Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Configuration: Target Date (Jan 2, 2026)
            // To use today's date, uncomment: const date = new Date();
            const date = new Date('2026-01-02T12:00:00');

            const solar = Solar.fromDate(date);
            const lunar = Lunar.fromDate(date);

            // 1. Header Info
            const monthsEn = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
            document.getElementById('en-month').textContent = monthsEn[solar.getMonth() - 1];
            document.getElementById('year-box').textContent = solar.getYear();

            // Lunar Month + Size approximation or just Month
            // lunar.getMonthInChinese() returns "Ê≠£Êúà", "‰∫åÊúà" etc.
            // Check if big month: lunar.getDayCount()
            // lunar.getDaysInMonth()? No, need to calculate next month diff manually or trust generic "Month"
            document.getElementById('zh-month').textContent = lunar.getMonthInChinese() + "Êúà" + (lunar.getDayCount && lunar.getDayCount() > 29 ? "Â§ß" : (lunar.getDayCount ? "Â∞è" : ""));

            // 2. Main Date
            document.getElementById('day-num').childNodes[0].nodeValue = solar.getDay();

            // Zodiac Overlay
            const zodiac = lunar.getYearShengXiao(); // "Ëõá" for 2025/2026 overlapping
            const zodiacIcon = document.getElementById('zodiac-overlay');
            zodiacIcon.innerHTML = '';
            const zSpan = document.createElement('span');
            zSpan.className = 'z-icon';
            zSpan.style.opacity = '0.08';
            zSpan.style.fontSize = '15rem';
            zSpan.style.top = '50%';
            zSpan.style.left = '50%';
            zSpan.style.transform = 'translate(-50%, -50%)';
            const zodiacMap = { 'Èº†': 'üêÄ', 'Áâõ': 'üêÇ', 'Ëôé': 'üêÖ', 'ÂÖî': 'üêá', 'Èæô': 'üêâ', 'Ëõá': 'üêç', 'È©¨': 'üêé', 'Áæä': 'üêê', 'Áå¥': 'üêí', 'È∏°': 'üêì', 'Áãó': 'üêï', 'Áå™': 'üêñ' };
            zSpan.textContent = zodiacMap[zodiac] || 'üßß';
            zodiacIcon.appendChild(zSpan);

            // 3. Middle Banners
            document.getElementById('lunar-date-text').textContent = lunar.getMonthInChinese() + "Êúà" + lunar.getDayInChinese();

            // Solar Term
            const jieQi = lunar.getJieQi();
            document.getElementById('solar-term-text').textContent = jieQi ? jieQi : "ÂÜ¨ÊúàÂÆâÂ∫∑"; // Fallback text

            // Weekday
            const weekEn = ["SUNDAY", "MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY"];
            const weekZh = ["Êó•", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠"];
            document.getElementById('zh-weekday').textContent = "ÊòüÊúü" + weekZh[solar.getWeek()];
            document.getElementById('en-weekday').textContent = weekEn[solar.getWeek()];

            // 4. Yi / Ji Lists
            const yiItems = lunar.getDayYi();
            const jiItems = lunar.getDayJi();
            const populateList = (element, items) => {
                element.innerHTML = '';
                items.slice(0, 6).forEach(item => { // limit to 6
                    const li = document.createElement('li');
                    li.textContent = item;
                    element.appendChild(li);
                });
            };
            populateList(document.getElementById('yi-list'), yiItems);
            populateList(document.getElementById('ji-list'), jiItems);

            // 5. Center Grid & BaZi
            const centerCol = document.querySelector('.col-center-grid');
            centerCol.innerHTML = '';

            // BaZi Display
            const baziDiv = document.createElement('div');
            baziDiv.className = 'bazi-display';
            baziDiv.style.borderBottom = '1px solid var(--ink-red)';
            baziDiv.style.padding = '5px';
            baziDiv.style.textAlign = 'center';
            baziDiv.style.background = '#fff8e7';
            baziDiv.style.display = 'flex';
            baziDiv.style.flexDirection = 'column';
            baziDiv.style.justifyContent = 'center';
            baziDiv.style.height = '60px'; // fixed height for BaZi

            const baziText = document.createElement('div');
            baziText.style.fontSize = '1.3rem';
            baziText.style.fontWeight = 'bold';
            baziText.style.color = 'var(--ink-black)';
            baziText.style.fontFamily = 'var(--font-calligraphy)';

            // Get 3 Pillars: Year, Month, Day
            const yGZ = lunar.getYearInGanZhi();
            const mGZ = lunar.getMonthInGanZhi();
            const dGZ = lunar.getDayInGanZhi();
            baziText.textContent = `${yGZ} ${mGZ} ${dGZ}`;
            baziDiv.appendChild(baziText);

            const directions = document.createElement('div');
            directions.style.fontSize = '0.7rem';
            directions.style.color = 'var(--ink-green)';
            directions.textContent = `Âñú${lunar.getPositionXi()} Ë¥¢${lunar.getPositionCai()} (‰ªäÊó•ÂÖ´Â≠ó)`;
            baziDiv.appendChild(directions);

            centerCol.appendChild(baziDiv);

            // Time Grid (4 columns x 3 rows = 12 cells)
            const timeGrid = document.createElement('div');
            timeGrid.className = 'fortune-grid';
            timeGrid.style.display = 'grid';
            timeGrid.style.gridTemplateColumns = 'repeat(4, 1fr)';
            // Ensure grid fills remaining space
            timeGrid.style.height = 'calc(100% - 70px)';
            timeGrid.style.width = '100%';

            const zhi = ["Â≠ê", "‰∏ë", "ÂØÖ", "ÂçØ", "Ëæ∞", "Â∑≥", "Âçà", "Êú™", "Áî≥", "ÈÖâ", "Êàå", "‰∫•"];

            // Huang Dao (Yellow Path) Luck Calculation
            // 1. Get Day Branch Index (0=Zi, 1=Chou, ... 11=Hai)
            const dayZhiIndex = lunar.getDayZhiIndex();

            // 2. Determine "QingLong" (Blue Dragon) Start Offset
            // Mapping (DayZhi % 6) -> StartOffset
            const offsetMap = {
                0: 8, // Zi -> Shen
                1: 10, // Chou -> Xu
                2: 0, // Yin -> Zi
                3: 2, // Mao -> Yin
                4: 4, // Chen -> Chen
                5: 6  // Si -> Wu
            };
            const qingLongStart = offsetMap[dayZhiIndex % 6];

            // 3. The 12 Deities Cycle (1=Good, 0=Bad)
            const deityLuck = [1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0];

            for (let i = 0; i < 12; i++) {
                const el = document.createElement('div');
                el.className = 'grid-cell time-cell';
                el.style.display = 'flex';
                el.style.flexDirection = 'column';
                el.style.justifyContent = 'center';
                el.style.alignItems = 'center';
                el.style.border = '1px solid #ddd';
                el.style.fontSize = '0.9rem';

                const zhiName = document.createElement('span');
                zhiName.textContent = zhi[i];
                zhiName.style.fontWeight = 'bold';

                // Calculate Luck
                let cycleIdx = (i - qingLongStart + 12) % 12;
                const isGood = deityLuck[cycleIdx] === 1;

                const luck = document.createElement('span');
                luck.textContent = isGood ? 'Âêâ' : 'Âá∂';
                luck.className = isGood ? 'luck-good' : 'luck-bad';

                el.appendChild(zhiName);
                el.appendChild(luck);
                timeGrid.appendChild(el);
            }
            centerCol.appendChild(timeGrid);
        });
    </script>
</body>

</html>