<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Chinese Calendar</title>
    <!-- Noto Serif CJK TC Import -->
    <link href="https://fonts.googleapis.com/earlyaccess/notoserifcjktc.css" rel="stylesheet" />
    <link rel="stylesheet" href="static/style.css">
    <!-- Lunar JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.7.7/lunar.min.js"></script>
</head>

<body class="green-theme">
    <div class="calendar-container">

        <!-- Top Bar: Month | Year | Lunar Month Info -->
        <header class="top-bar">
            <div class="top-left box-bordered">
                <span class="en-month" id="month-name"></span>
            </div>

            <div class="top-center">
                <div class="year-pill" id="year-pill"></div>
            </div>

            <div class="top-right box-bordered">
                <span class="zh-month" id="lunar-month-info"></span>
            </div>
        </header>

        <!-- Main Body: Giant Date Number -->
        <main class="main-body">
            <div class="giant-date" id="giant-day"></div>
            <!-- Prominent Lunar Date: Format [Month]月[Day] -->
            <div class="lunar-prominent" id="lunar-date-full"></div>
        </main>

        <!-- Lower Section: Grid Info -->
        <section class="lower-section">
            <!-- Info Bar: Year Cycle | Weekday -->
            <div class="info-bar">
                <div class="info-left">
                    <span id="lunar-year-ganzhi"></span>
                </div>
                <div class="info-right">
                    <span class="en-weekday" id="weekday-en"></span>
                    <span class="zh-weekday" id="weekday-zh"></span>
                </div>
            </div>

            <!-- Yi/Ji Grid -->
            <div class="luck-grid">
                <!-- Yi (Good) -->
                <div class="luck-cell good-cell">
                    <div class="luck-icon good-icon">宜</div>
                    <div class="luck-list" id="yi-list"></div>
                </div>

                <!-- Ji (Bad) -->
                <div class="luck-cell bad-cell">
                    <div class="luck-icon bad-icon">忌</div>
                    <div class="luck-list" id="ji-list"></div>
                </div>
            </div>

            <!-- Footer: Dual Quotes & Solar Term -->
            <footer class="footer-bar">
                <div class="quote-container" id="quote-container"></div>

                <div class="solar-term-box" id="solar-term-box" style="display: none;"></div>

                <!-- Footer Signoff -->
                <div class="footer-signoff" style="color: var(--theme-green);">
                    Fatt Choy HOH 2026
                </div>
            </footer>
        </section>
    </div>

    <!-- Main Logic Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Gregorian Date Setup
            const now = new Date();
            const year = now.getFullYear();
            // Use Numeric Month (1-12)
            const monthName = now.getMonth() + 1;
            const day = now.getDate();
            const weekdayEn = now.toLocaleDateString('en-US', { weekday: 'long' });

            const weekdayMap = {
                'Monday': '一', 'Tuesday': '二', 'Wednesday': '三', 'Thursday': '四',
                'Friday': '五', 'Saturday': '六', 'Sunday': '日'
            };
            const weekdayZh = '星期' + weekdayMap[weekdayEn];

            // Render Gregorian
            document.getElementById('month-name').textContent = monthName;
            document.getElementById('year-pill').textContent = year;
            document.getElementById('giant-day').textContent = day;
            document.getElementById('weekday-en').textContent = weekdayEn;
            document.getElementById('weekday-zh').textContent = weekdayZh;

            // 2. Lunar Calculation
            const lunar = Lunar.fromDate(now);

            // Lunar Year: GanZhi + Zodiac
            const lunarYear = lunar.getYearInGanZhi() + ' (' + lunar.getYearShengXiao() + ')';
            document.getElementById('lunar-year-ganzhi').textContent = lunarYear;

            // Lunar Month & Size
            const lunarMonthName = lunar.getMonthInChinese();
            // Size Logic
            let isBig = '小';
            try {
                const lYear = lunar.getYear();
                const lMonth = lunar.getMonth();
                const d30 = Lunar.fromYmd(lYear, lMonth, 30);
                if (d30.getMonth() === lMonth) {
                    isBig = '大';
                }
            } catch (e) { }

            document.getElementById('lunar-month-info').textContent = lunarMonthName + '月' + isBig;

            // --- CHANGED: Strict Numeric Month for Center Display ---
            // Helper to get One, Two ... Twelve
            function getNumericChineseMonth(m) {
                const map = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二'];
                return map[m - 1] || '';
            }
            const numericMonth = getNumericChineseMonth(lunar.getMonth());

            // Update Top Right Month Info to use Numeric Month as well
            // e.g. 十一月大 instead of 冬月大
            document.getElementById('lunar-month-info').textContent = numericMonth + '月' + isBig;

            const lunarDayName = lunar.getDayInChinese();

            // Format: 農曆 + Month + 月 + Day + 日
            // E.g. 農曆十一月十二日
            document.getElementById('lunar-date-full').textContent = '農曆' + numericMonth + '月' + lunarDayName + '日';


            // Solar Term
            const jieQi = lunar.getJieQi();
            const termBox = document.getElementById('solar-term-box');
            if (jieQi) {
                termBox.textContent = jieQi;
                termBox.style.display = 'block';
            }

            // 3. Yi / Ji Lists
            const yiList = lunar.getDayYi(); // Array
            const jiList = lunar.getDayJi(); // Array

            const yiContainer = document.getElementById('yi-list');
            yiList.forEach(item => {
                const span = document.createElement('span');
                span.className = 'luck-item';
                span.textContent = item;
                yiContainer.appendChild(span);
            });

            const jiContainer = document.getElementById('ji-list');
            jiList.forEach(item => {
                const span = document.createElement('span');
                span.className = 'luck-item';
                span.textContent = item;
                jiContainer.appendChild(span);
            });

            // 4. Quotes System
            const quotes = [
                "大吉大利", "万事如意", "心想事成", "身体健康",
                "恭喜发财", "年年有余", "步步高升", "一帆风顺",
                "金玉满堂", "吉星高照", "花开富贵", "国泰民安"
            ];

            // Shuffle and pick 2
            function getMultipleRandom(arr, num) {
                const shuffled = [...arr].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, num);
            }
            const selectedQuotes = getMultipleRandom(quotes, 2);

            const quoteContainer = document.getElementById('quote-container');
            selectedQuotes.forEach(q => {
                const span = document.createElement('span');
                span.className = 'quote-text';
                span.textContent = q;
                quoteContainer.appendChild(span);
            });
        });
    </script>
</body>

</html>